tosca_definitions_version: cloudify_dsl_1_0

imports:
    - http://www.getcloudify.org/spec/cloudify/3.1rc2/types.yaml
    - plugin.yaml

inputs:
    host: {}
    username: {}
    password: {}
    pool_id: {}
    node1_address: {}
    node1_port: {}

node_templates:
    bigip:
        type: bigip_server
        properties:
            host: { get_input: host }
            username: { get_input: username }
            password: { get_input: password }
            pool_configs: [[{ get_input: pool_id }, LB_METHOD_ROUND_ROBIN]]

    node1:
        type: cloudify.nodes.Root
        relationships:
            - type: cloudify.bigip.connected_to_bigip
              target: bigip
              source_interfaces:
                cloudify.interfaces.relationship_lifecycle:
                    establish:
                        inputs:
                            pool_id: { get_input: pool_id }
                            address: { get_input: node1_address }
                            port: { get_input: node1_port }
                    unlink:
                        inputs:
                            pool_id: { get_input: pool_id }
                            address: { get_input: node1_address }
                            port: { get_input: node1_port }
